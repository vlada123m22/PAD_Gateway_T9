global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    tcp
    timeout connect 10s
    timeout client  30s
    timeout server  30s
    timeout check   5s
    option  tcplog

# PostgreSQL Rumors Service Proxy
frontend postgres-rumors-frontend
    bind *:5432
    default_backend postgres-rumors-backend

backend postgres-rumors-backend
    balance leastconn
    option pgsql-check user ${POSTGRES_USER}

    # Primary handles all writes
    server postgres-rumors-primary postgres-rumors-primary:5432 check inter 3000 rise 2 fall 3 weight 100
    # Replica can handle read queries (backup mode)
    server postgres-rumors-replica postgres-rumors-replica:5432 check inter 3000 rise 2 fall 3 weight 50 backup

listen stats
    bind *:8411
    stats enable
    stats uri /stats
    stats refresh 5s



