global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    tcp
    timeout connect 10s
    timeout client  30s
    timeout server  30s
    timeout check   5s
    option  tcplog

# MongoDB Character Replica Set Proxy
frontend mongodb-character-frontend
    bind *:27017
    default_backend mongodb-character-backend

backend mongodb-character-backend
    balance leastconn
    mode tcp
    option tcp-check
    tcp-check connect

    # Primary server for writes
    server mongo-character-primary mongo-character-primary:27017 check inter 3000 rise 2 fall 3 weight 100
    server mongo-character-secondary-1 mongo-character-secondary-1:27017 check inter 3000 rise 2 fall 3 weight 50 backup

listen stats
    bind *:8407
    stats enable
    stats uri /stats
    stats refresh 5s



